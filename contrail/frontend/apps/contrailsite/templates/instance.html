{% extends 'base.html' %}
{% load staticfiles %}
{% load crispy_forms_tags %}
{% load contrail %}

{% block title %}{{ rawInstanceDetails.instanceType }} - {% firstof rawInstanceDetails.location rawInstanceDetails.region %} - CONTRAIL{% endblock %}

{% block css %}
<link rel="stylesheet" href="{% static 'css/sidebar.css' %}">
<!-- CHART.JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.13.0/moment.min.js"></script>
<script src="https://www.chartjs.org/dist/2.8.0/Chart.min.js"></script>
<script src="https://www.chartjs.org/samples/latest/utils.js"></script>
{% endblock %}

{% block content %}
<br><br><br><br><br>
  <div class="container">
    <div class="row">
      <div class="col">
        <h1 style="text-align: center;">{{ rawInstanceDetails.provider }} {{ rawInstanceDetails.instanceType }}</h1>
        <h2 style="text-align: center;">{% firstof rawInstanceDetails.location rawInstanceDetails.region %}</h2>
      </div>
    </div>
  </div>
</div>


  <div class="container">

        <br><br><br>
        <table id="instances" class="table table-striped table-hover table-bordered" style="width:100%">
            <tbody>
            {% for detail in instanceDetails %}
                <tr title="{{ detail.hint }}">
                    <th>
                        {% if detail.link %}<a href="{{ detail.link }}" target="_blank">{% endif %}
                            {{ detail.name }}
                            {% if detail.link %}
                                &nbsp;&#8599;
                            {% endif %}
                            {% if detail.hint %}
                                &nbsp;&#65533;
                            {% endif %}
                        {% if detail.link %}</a>{% endif %}
                    </th>
                    <td>
                        {{ detail.value }} {{ detail.unit }}
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>

        <br><h2 style="text-align:center;">Pricing</h2><br>

        <div class="row">
          {% if rawInstanceDetails.provider == 'AmazonEC2' %}
          <div class="col-sm-4">
          {% else %}
          <div class="col-sm-6">
          {% endif %}
            <div class="card">
              <div class="card-body">
                <h4 class="card-title">On Demand</h4><hr>
                <h5 class="card-title"><span style="font-size: 3em;">${{ priceHistory.onDemand.0.pricePerHour }}</span><br>per hour</h5>
                <p class="card-text">{{ priceHistory.onDemand.0.pricePerHour|hourly_to_monthly }} per month</p>
{#                <a href="#" class="btn btn-primary">Go somewhere</a>#}
              </div>
            </div>
          </div>
          {% if rawInstanceDetails.provider == 'AmazonEC2' %}
          <div class="col-sm-4">
            <div class="card">
              <div class="card-body">
                <h4 class="card-title">Reserved</h4><hr>

                <a data-toggle="collapse" href="#one" aria-expanded="false" aria-controls="one"><h5>One Year &#x2C5;</h5></a>
                <div class="collapse multi-collapse" id="one">
                  <div class="card card-body">
                    <h5 class="card-title"><span style="font-size: 1.2em;">{{ priceHistory.reserved1yrFullUpfront.0.priceUpfront|price }}</span> upfront</h5>
                    <p class="card-text">Full Upfront</p><hr style="margin-top: 0px;">
                    <h5 class="card-title"><span style="font-size: 1.2em;">{{ priceHistory.reserved1yrPartialUpfront.0.priceUpfront|price }}</span> upfront</h5>
                    <h5 class="card-title"><span style="font-size: 1.2em;">{{ priceHistory.reserved1yrPartialUpfront.0.pricePerHour|price }}</span> per hour</h5>
                    <p class="card-text">Partial Upfront</p><hr style="margin-top: 0px;">
                    <h5 class="card-title"><span style="font-size: 1.2em;">{{ priceHistory.reserved1yrNoUpfront.0.pricePerHour|price }}</span> per hour</h5>
                    <p class="card-text">No Upfront</p>
                  </div>
                </div><br>

                <a data-toggle="collapse" href="#three" aria-expanded="false" aria-controls="three"><h5>Three Years &#x2C5;</h5></a>
                <div class="collapse multi-collapse" id="three">
                  <div class="card card-body">
                    <h5 class="card-title"><span style="font-size: 1.2em;">{{ priceHistory.reserved3yrFullUpfront.0.priceUpfront|price }}</span> upfront</h5>
                    <p class="card-text">Full Upfront</p><hr style="margin-top: 0px;">
                    <h5 class="card-title"><span style="font-size: 1.2em;">{{ priceHistory.reserved3yrPartialUpfront.0.priceUpfront|price }}</span> upfront</h5>
                    <h5 class="card-title"><span style="font-size: 1.2em;">{{ priceHistory.reserved3yrPartialUpfront.0.pricePerHour|price }}</span> per hour</h5>
                    <p class="card-text">Partial Upfront</p><hr style="margin-top: 0px;">
                    <h5 class="card-title"><span style="font-size: 1.2em;">{{ priceHistory.reserved3yrNoUpfront.0.pricePerHour|price }}</span> per hour</h5>
                    <p class="card-text">No Upfront</p>
                  </div>
                </div><br>

{#                <a href="#" class="btn btn-primary">Go somewhere</a>#}
              </div>
            </div>
          </div>
          {% endif %}
          {% if rawInstanceDetails.provider == 'AmazonEC2' %}
          <div class="col-sm-4">
          {% else %}
          <div class="col-sm-6">
          {% endif %}
            <div class="card">
              <div class="card-body">
                <h4 class="card-title">Spot</h4><hr>
                <h5 class="card-title"><span style="font-size: 3em;">${{ priceHistory.spot.0.pricePerHour }}</span><br>per hour</h5>
                <p class="card-text">{{ priceHistory.spot.0.pricePerHour|hourly_to_monthly }} per month</p>
{#                <a href="#" class="btn btn-primary">Go somewhere</a>#}
              </div>
            </div>
          </div>
        </div>

      <div class="line"></div>

      <h2 style="text-align:center;">Price History</h2>

      <canvas id="canvas" style="display: block; width: 621px; height: 310px;" width="621" height="310" class="chartjs-render-monitor"></canvas>
</div>


{% endblock %}


{% block script %}

<!-- BOOTSTRAP TABLE -->
<script type="text/javascript">
  $(document).ready(function() {
    $('#instances').DataTable( {
        // "paging":   false,
        "ordering": true,
        // "info":     false,
        "columns": []
    } );
  } );
</script>

<!-- CHART.JS -->
<script>
  // https://www.chartjs.org/samples/latest/scales/time/line.html
		var timeFormat = 'MM/DD/YYYY HH:mm';

		function newDate(days) {
			return moment().add(days, 'd').toDate();
		}

		function newDateString(days) {
			return moment().add(days, 'd').format(timeFormat);
		}

		var color = Chart.helpers.color;
		var config = {
			type: 'line',
			data: {
				labels: [ // Date Objects
					newDate(0),
					newDate(1),
					newDate(2),
					newDate(3),
					newDate(4),
					newDate(5),
					newDate(6)
				],
				datasets: [{
					label: 'On Demand',
					backgroundColor: color(window.chartColors.red).alpha(0.5).rgbString(),
					borderColor: window.chartColors.red,
					fill: false,
					data: [
						randomScalingFactor(),
						randomScalingFactor(),
						randomScalingFactor(),
						randomScalingFactor(),
						randomScalingFactor(),
						randomScalingFactor(),
						randomScalingFactor()
					],
				}, {
					label: 'Reserved',
					backgroundColor: color(window.chartColors.blue).alpha(0.5).rgbString(),
					borderColor: window.chartColors.blue,
					fill: false,
					data: [
						randomScalingFactor(),
						randomScalingFactor(),
						randomScalingFactor(),
						randomScalingFactor(),
						randomScalingFactor(),
						randomScalingFactor(),
						randomScalingFactor()
					],
				}, {
					label: 'Spot',
					backgroundColor: color(window.chartColors.green).alpha(0.5).rgbString(),
					borderColor: window.chartColors.green,
					fill: false,
					data: [{
						x: newDateString(0),
						y: randomScalingFactor()
					}, {
						x: newDateString(5),
						y: randomScalingFactor()
					}, {
						x: newDateString(7),
						y: randomScalingFactor()
					}, {
						x: newDateString(15),
						y: randomScalingFactor()
					}],
				}]
			},
			options: {
				title: {
					text: 'Chart.js Time Scale'
				},
				scales: {
					xAxes: [{
						type: 'time',
						time: {
							parser: timeFormat,
							// round: 'day'
							tooltipFormat: 'll HH:mm'
						},
						scaleLabel: {
							display: true,
							labelString: 'Date'
						}
					}],
					yAxes: [{
						scaleLabel: {
							display: true,
							labelString: 'value'
						}
					}]
				},
			}
		};

		window.onload = function() {
			var ctx = document.getElementById('canvas').getContext('2d');
			window.myLine = new Chart(ctx, config);

		};

	</script>

{% endblock %}
